pipeline {
  agent {
    kubernetes {
      yaml '''
        apiVersion: v1
        kind: Pod
        spec:
          containers:
          - name: mavenassur
            image: hnouri86/mavenassur:1.0.20240127
            command: ["/bin/sh", "-c"]
            args: ["while true; do sleep 3600; done"]
            securityContext:
              allowPrivilegeEscalation: false
              capabilities:
                add:
                  - NET_ADMIN
          dnsPolicy: "Default"
          hostNetwork: true

        '''
    }
  }
  stages {
    stage('Run maven version') {
      steps {
        container('maven') {
          sh 'mvn --version'
          sh 'echo Hello World'
        }
      }
    }
    stage('code review to check quality of code') {
      steps {
        container('maven') {
          sh 'mvn pmd:pmd'
          sh 'echo code review done'
        }
      }
    }
    stage('Run maven') {
      steps {
        container('maven') {
          sh 'echo Hello World'
          sh 'mvn clean package'
        }
      }
    }
    stage('Push to Nexus Repository') {
      steps {
        container('maven') {
          sh 'mvn deploy:deploy-file -Dfile=target/*.war -DgroupId=your.group.id -DartifactId=your-artifact-id -Dversion=1.0.0 -Dpackaging=war -Durl=http://192.168.1.196:8081/repository/AssurProject-Test/ -DrepositoryId=nexus-repo-id'

        }
      }
    }
  }
}
